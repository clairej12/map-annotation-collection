<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>Hand Drawn Map Task</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <!-- Single source of instructions -->
    <template id="instructions-template">
    <h2>Instructions</h2>

    <p>You will complete <strong>6 routes</strong>. For each route, follow the steps below.</p>

    <p><strong>Estimated time:</strong> Most participants finish in <strong>45–60 minutes</strong>.</p>

    <h3>What you will see</h3>
    <ul>
    <li>
        A <strong>street-view video</strong> of a route depicting a navigator’s perspective as they traverse the route.
    </li>

    <li>
        During the video, markers <strong>A, B, and C</strong> will briefly appear at the bottom-left corner at three different moments.
        <ul>
        <li>The markers may appear in <strong>any order</strong>.</li>
        <li>Each marker appears only briefly.</li>
        </ul>
    </li>

    <li>
        A <strong>satellite map</strong> (click <em>“See Satellite Map”</em>) showing the same route from
        <strong>Start (S)</strong> to <strong>Goal (G)</strong>, passing through points
        <strong>A, B, and C</strong> in the same order as the video.
    </li>
    </ul>

    <h3>Your task</h3>
    <ol>
    <li>
        <strong>Draw a sketch map</strong> on the canvas that would allow someone to navigate from
        <strong>Start (S)</strong> to <strong>Goal (G)</strong>, stopping accurately at
        <strong>A, B, and C</strong> along the way.

        <p><strong>Important:</strong> Your sketch does <em>not</em> need to be artistically accurate or to scale.
        Simple lines, arrows, and rough shapes are sufficient.</p>

        <ul>
        <li>
            Label the points in the <strong>order they appear along the path</strong>
            (e.g., <em>S → B → A → C → G</em>).
        </li>
        <li>
            Include helpful <strong>landmarks</strong> (e.g., buildings, shops, signs, trees).
        </li>
        <li>
            Include key <strong>road features</strong> (e.g., intersections, turns, crossings).
        </li>
        <li>
            Clearly show how the route connects from
            <strong>Start → A/B/C → A/B/C → A/B/C → Goal</strong>.
        </li>
        </ul>

        <p><strong>Text-only maps are not acceptable.</strong> Your sketch must include
        <strong>drawn paths or shapes</strong> (lines, arrows, or curves).</p>

        <p>
        <em>Test yourself:</em>
        If the markers A/B/C were removed from the video, could someone use your sketch map
        to pause the video at the correct moments for A, B, and C?
        </p>

        <p>
        <em>Tip:</em> Each point A/B/C should have at least one landmark or road feature separating it from the next.
        </p>
    </li>

    <li>
        When you are satisfied with your <strong>sketch map</strong>, click
        <strong>“Proceed to Landmarks”</strong>.
        <p><strong>Important:</strong> You will not be able to return to your drawing after this step.</p>
    </li>

    <li>
        On the <strong>Landmarks</strong> page, create an <strong>ordered list</strong> of the landmarks and road
        features shown in your sketch.
        <ul>
        <li>You must include <strong>Start, Goal, and points A/B/C</strong>.</li>
        <li>You may <strong>edit text</strong>, <strong>add or delete items</strong>, and
            <strong>drag-and-drop</strong> to reorder the list.</li>
        </ul>
    </li>
    </ol>

    <p>
    When you are satisfied with the <strong>landmark list</strong>, click
    <strong>“Save & Next”</strong>.
    </p>

    <p>
    After completing all routes, click <strong>“Submit All”</strong>.
    </p>

    <h3>Additional Notes</h3>
    <ul>
    <li>You can click on the <strong>satellite map</strong> to enlarge it.</li>
    <li>You can rewatch the video as many times as you like and use the scrub bar to jump between parts of the video.</li>
    </ul>
    </template>

    <!-- Instructions Page -->
    <div id="instr-page" class="page active">
        <h1>Welcome!</h1>
        <div id="instr-content"></div>
        <h2>Example</h2>
        <!-- Example Section -->
        <div id="example-container" class="example">
            <!-- Side-by-side example -->
            <div class="example-maps">
                <div>
                    <h4>Satellite Map</h4>
                    <img src="{{ url_for('static', filename='images/rid_72.png') }}" 
                        alt="Example satellite map" 
                        style="max-width:100%;border:1px solid #ccc;">
                </div>
                <div>
                    <h4>Hand-Drawn Map</h4>
                    <img src="{{ url_for('static', filename='images/Boston Map Sketch.jpg') }}" 
                        alt="Example sketch map" 
                        style="max-width:100%;border:1px solid #ccc;">
                </div>
            </div>

            <!-- Observations carousel -->
            <div class="example-observations" style="margin-top:1rem;">
                <h4>Example Observations</h4>
                <video
                    id="example-obs-video"
                    width="100%"
                    controls
                    preload="metadata"
                >
                    <source src="{{ url_for('serve_video', filename='rid_72.mp4') }}" type="video/mp4">
                </video>
            </div>

            <!-- Example landmarks -->
            <div class="example-landmarks" style="margin-top:1rem;">
                <h4>Example Landmark List (in the order they are seen in the observations)</h4>
                <ul>
                    <li>Start (S)</li>
                    <li>First intersection with crosswalks</li>
                    <li>Second intersection with crosswalks</li>
                    <li>Point B</li>
                    <li>Third intersection with crosswalks</li>
                    <li>Pass through fourth intersection with crosswalks</li>
                    <li>Turn onto alleyway</li>
                    <li>Parking spots on either side of the street</li>
                    <li>Point C</li>
                    <li>Tall brick buildings on either side</li>
                    <li>Pass through fifth intersection with crosswalks</li>
                    <li>Turn onto Public Alley</li>
                    <li>Parking spots on either side of the street</li>
                    <li>Point A</li>
                    <li>Turn out of alleyway</li>
                    <li>Pass through sixth intersection with crosswalks</li>
                    <li>Pass seventh intersection with crosswalks</li>
                    <li>Park with grass and trees on either side of the street</li>
                    <li>Turn at eighth intersection with crosswalks</li>
                    <li>End (G)</li>
                </ul>
            </div>
        </div>

        <button id="begin-btn">Begin Tasks</button>
    </div>

    <!-- Quiz Page -->
    <div id="quiz-page" class="page">
    <h1>Quiz</h1>
    <div class="quiz-visuals">
    <!-- Quiz map -->
    <div class="quiz-map">
        <img src="{{ url_for('static', filename='images/Boston Map Sketch.jpg') }}" 
            alt="Example sketch map"
            class="quiz-img">
    </div>

    <!-- Observations carousel -->
    <div class="quiz-observations">
        <video
            id="example-obs-video"
            width="100%"
            controls
            preload="metadata"
        >
            <source src="{{ url_for('serve_video', filename='rid_72.mp4') }}" type="video/mp4">
        </video>
    </div>
    </div>
    <div id="quiz-content">
        <h3>Drag and drop Start, End, and Points A/B/C into the correct positions in the landmark sequence based on the map and order they are seen in the observations. Once you complete this quiz, you will be able to move onto the task.</h3>
        <ul id="quiz-landmark-list"></ul>
        <button id="submit-quiz-btn">Submit</button>
        <div id="quiz-feedback" style="margin-top:1rem;font-weight:bold;"></div>
    </div>
    </div>


    <!-- Task Page -->
    <div id="task-page" class="page">
        <div id="user-info" style="margin-bottom: 1em; font-weight: bold;">
            User ID: {{ user_id }}, Study ID: {{ study_id }}
        </div>

        <div id="route-indicator" style="font-weight: bold; margin-bottom: 0.5rem;">
            Route 1 of 6
        </div>

        <button id="show-instructions-btn" style="margin-left:auto;">Show Instructions</button>

        <div id="instructions-modal" style="display:none;">
            <div id="modal-instr-content"></div>
        </div>

        <!-- Map (hidden by default, button to open modal) -->
        <div class="map" id="map-container">
            <button id="open-map-btn">See Satellite Map</button>
            <div id="map-modal">
                <img alt="Map" id="map-img">
                <button id="map-hide-btn" aria-label="Hide map">✕</button>
            </div>
        </div>

        <!-- Observations -->
        <div class="observations">
            <h2>Observations</h2>
            <video id="obs-video" controls preload="metadata" width="800">
                <source id="obs-video-src" type="video/mp4">
            </video>
        </div>

        <!-- Drawing Board -->
        <div class="drawing-container">
            <section class="tools-board">
                <div class="row">
                    <h1 class="title">TOOLS</h1>
                    <label class="title">Shapes</label>
                    <ul class="options">
                        <li class="option tool" id="rectangle"><img src="{{ url_for('static', filename='icons/rectangle.svg') }}"><span>Rectangle</span></li>
                        <li class="option tool" id="circle"><img src="{{ url_for('static', filename='icons/circle.svg') }}"><span>Circle</span></li>
                        <li class="option tool" id="triangle"><img src="{{ url_for('static', filename='icons/triangle.svg') }}"><span>Triangle</span></li>
                        <li class="option tool" id="line"><img src="{{ url_for('static', filename='icons/line.svg') }}"><span>Line</span></li>
                        <li class="option tool" id="text"><span>Add Text Box</span></li>

                        <!-- <li class="option tool" id="random-draw"><img src="{{ url_for('static', filename='icons/polygone.svg') }}"><span>Random Draw</span></li> -->
                        <li class="option"><input type="checkbox" id="fill-color"><label for="fill-color">Fill shape</label></li>
                    </ul>
                </div>
                <div class="row">
                    <label class="title">Options</label>
                    <ul class="options">
                        <li class="option active tool" id="brush"><img src="{{ url_for('static', filename='icons/brush.svg') }}"><span>Brush</span></li>
                        <li class="option tool" id="eraser"><img src="{{ url_for('static', filename='icons/eraser.svg') }}"><span>Eraser</span></li>
                        <li class="option"><input type="range" id="size-slider" min="1" max="30" value="5"></li>
                    </ul>
                </div>
                <div class="row colors">
                    <label class="title">Colors</label>
                    <ul class="options">
                        <li class="option"></li>
                        <li class="option selected"></li>
                        <li class="option"></li>
                        <li class="option"></li>
                        <li class="option"><input type="color" id="color-picker" value="#4A98F7"></li>
                    </ul>
                </div>
                <div class="row buttons">
                    <button id="undo-btn">Undo</button>
                    <button id="redo-btn">Redo</button>
                    <button class="clear-canvas">Clear Workspace</button>
                    <button class="save-img">Commit Current Drawing</button>
                </div>
            </section>
            <section class="drawing-board">
                <canvas id="canvas"></canvas>
            </section>
        </div>

        <!-- Navigation to Landmark Page -->
        <div style="margin-top: 1rem;">
            <button type="button" id="go-to-landmarks-btn">Proceed to Landmarks</button>
        </div>
    </div>

    <!-- Landmark Page -->
    <div id="landmark-page" class="page">
        <h2>Landmarks</h2>
        <!-- Re-display saved drawing -->
        <div id="saved-drawing-container">
            <h3>Your Saved Sketch Map </h3>
            <img id="saved-drawing-img" alt="Saved sketch map" >
        </div>

        <!-- Landmarks List -->
        <form id="landmarks-form">
            <label for="landmark-list">
                Please list all the landmarks you included in your drawing in the order they are seen in the observations.  
                <br>
                You must include Start (S), Goal (G), and Points A/B/C.
            </label>
            <ul id="landmark-list">
                <!-- Landmarks will be injected dynamically via JS -->
            </ul>
            <input type="hidden" name="landmarks" id="landmarks-input">
            <button type="button" id="save-landmarks-btn">Save Landmarks</button>
        </form>

        <!-- Continue -->
        <button type="button" id="submit-all-btn" style="display:block;margin:auto;">Submit All</button>
        <button type="button" id="save-btn">Save & Next</button>
    </div>

    <!-- Screenout Page -->
    <div id="screenout-page" class="page">
    <h1>Thank you for your time</h1>

    <p>
        Unfortunately, you were not able to pass the short quiz after the maximum number of attempts,
        so you cannot continue this study.
    </p>
    
    <p style="margin-top: 1rem; font-size: 0.95rem; opacity: 0.8;">
        If you believe this is an error, please return the submission on Prolific and contact the researcher.
    </p>
    </div>

    <!-- Done Page -->
    <div id="done-page" class="page">
        <h2>Submitting your responses…</h2>
        <p>You will be redirected to Prolific automatically.</p>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</body>
</html>